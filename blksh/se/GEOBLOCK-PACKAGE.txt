â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘         GEO-BLOCKING TOOLKIT FOR MAIL SERVERS                â•‘
â•‘                                                              â•‘
â•‘  Complete solution for blocking countries at firewall level â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“¦ PACKAGE CONTENTS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. geoblock-setup.sh
   â†’ Main installation script
   â†’ Automated setup with one command
   â†’ Configure countries, whitelists, and attackers
   â†’ Makes everything persistent

2. GEOBLOCK-README.md  
   â†’ Complete documentation
   â†’ Configuration guide
   â†’ Troubleshooting tips
   â†’ Management commands

3. geoblock-quick-status.sh
   â†’ Quick status checker
   â†’ Shows what's blocked
   â†’ Verify configuration

4. test-geoblock.sh
   â†’ Test if an IP would be blocked
   â†’ Useful before adding countries

5. geoblock-manage (installed after setup)
   â†’ System-wide management tool
   â†’ Available at: /usr/local/bin/geoblock-manage
   â†’ Easy enable/disable/status commands


ğŸš€ QUICK START
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

For a new mail server:

1. Copy the files to your server:
   scp geoblock-* root@your-mailserver:/root/

2. Edit the configuration:
   nano geoblock-setup.sh
   
   Set:
   - BLOCKED_COUNTRIES (which countries to block)
   - WHITELIST_IP (your IP address)
   - ADDITIONAL_WHITELIST (other safe IPs)
   - ATTACKER_IPS (known attackers)

3. Run the setup:
   ./geoblock-setup.sh

4. Verify it worked:
   ./geoblock-quick-status.sh


ğŸ“‹ COMMON CONFIGURATIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Block the "usual suspects":
  BLOCKED_COUNTRIES=("cn" "ru" "ro" "pl" "kz" "ua" "vn")

Block common spam sources:
  BLOCKED_COUNTRIES=("cn" "ru" "br" "in" "vn" "kr")

Very restrictive (allow only US/EU):
  # Use a whitelist approach instead - contact me for that script


ğŸ”§ AFTER INSTALLATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Management commands available:

  geoblock-manage status        # Show current status
  geoblock-manage disable       # Temporarily disable
  geoblock-manage enable        # Re-enable  
  geoblock-manage add-ip IP     # Whitelist an IP
  geoblock-manage block-ip IP   # Block specific IP

Check what's happening:

  ./geoblock-quick-status.sh    # Quick overview
  nft list ruleset              # See all rules
  journalctl -u nftables-geoblock  # Service logs


âš ï¸  IMPORTANT NOTES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

1. ALWAYS set your IP in WHITELIST_IP before running
2. Test after setup to ensure you can still access the server
3. Keep console/KVM access available as backup
4. Rules persist across reboots automatically
5. Update IP ranges monthly for best protection


ğŸŒ COUNTRY CODES REFERENCE
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Common malicious sources:
  cn - China          ru - Russia        ro - Romania
  pl - Poland         kz - Kazakhstan    ua - Ukraine
  vn - Vietnam        in - India         br - Brazil
  kr - South Korea    th - Thailand      id - Indonesia

Full list: https://www.ipdeny.com/ipblocks/


ğŸ’¡ TIPS & TRICKS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â€¢ The script is idempotent - safe to run multiple times
â€¢ To add countries later, just edit and re-run the script
â€¢ Blocking happens at kernel level (very efficient)
â€¢ Works alongside mailcow's fail2ban (defense in depth)
â€¢ Does NOT interfere with Docker, mailcow, or Let's Encrypt


ğŸ“ EMERGENCY ACCESS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

If you get locked out, use console access:

  nft delete table inet geoblock

This immediately removes all geo-blocking.


ğŸ“ FILES CREATED BY SETUP
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

  /etc/nftables/geoblock.nft
    â†’ nftables configuration (all rules)

  /etc/systemd/system/nftables-geoblock.service
    â†’ Systemd service (auto-start on boot)

  /usr/local/bin/geoblock-manage
    â†’ Management tool (system-wide command)


ğŸ”’ WHAT GETS BLOCKED
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ“ All HTTP/HTTPS traffic from blocked countries
âœ“ SMTP/IMAP/POP3/Submission attempts  
âœ“ SSH brute force attacks
âœ“ Port scans and probes
âœ“ ANY network connection from blocked IPs

âœ— Does NOT block VPNs/proxies (they use different IPs)
âœ— Does NOT block Tor (needs separate configuration)


ğŸ“Š CURRENT INSTALLATION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

This server currently has geo-blocking active:
  â†’ Blocking: Romania, Russia, Poland, Kazakhstan
  â†’ Total: 15,414 networks blocked
  â†’ Your IP: 173.71.155.73 (whitelisted)
  â†’ Status: Active and persistent


ğŸ“ LEARNING RESOURCES
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

â€¢ nftables wiki: https://wiki.nftables.org/
â€¢ IP blocks source: https://www.ipdeny.com/
â€¢ Mailcow docs: https://docs.mailcow.email/
â€¢ This package README: cat GEOBLOCK-README.md


âœ… READY TO DEPLOY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Everything is ready to use on another server!

Just copy these files:
  â€¢ geoblock-setup.sh
  â€¢ GEOBLOCK-README.md  
  â€¢ geoblock-quick-status.sh
  â€¢ test-geoblock.sh

Configure, run, and you're protected! ğŸ›¡ï¸
